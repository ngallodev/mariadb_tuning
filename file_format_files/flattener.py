# Flattens each row to the expected column count, turning stray (unquoted) in-field newlines into spaces 
# `while keeping quoted newlines intact. Run it like this, swapping in your file names:
# python3 -c "import sys,base64;exec(compile(base64.b64decode('ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmltcG9ydCBzeXMKCnNyY19wYXRoLCBkc3RfcGF0aCA9IHN5cy5hcmd2WzFdLCBzeXMuYXJndlsyXQp0ZXh0ID0gUGF0aChzcmNfcGF0aCkucmVhZF90ZXh0KGVuY29kaW5nPSJ1dGYtOCIsIG5ld2xpbmU9IiIpCmlmIG5vdCB0ZXh0OgogICAgUGF0aChkc3RfcGF0aCkud3JpdGVfdGV4dCgiIiwgZW5jb2Rpbmc9InV0Zi04IikKICAgIHJhaXNlIFN5c3RlbUV4aXQKbGluZXMgPSB0ZXh0LnNwbGl0bGluZXMoKQpzZXAgPSAiLCIKZXhwZWN0ZWRfY29tbWFzID0gbGluZXNbMF0uY291bnQoc2VwKQoKZGVmIGFuYWx5emUocm93KToKICAgIGluX3F1b3RlcyA9IEZhbHNlCiAgICBjb21tYV9jb3VudCA9IDAKICAgIGkgPSAwCiAgICBuID0gbGVuKHJvdykKICAgIHdoaWxlIGkgPCBuOgogICAgICAgIGNoID0gcm93W2ldCiAgICAgICAgaWYgY2ggPT0gIlwiIjoKICAgICAgICAgICAgaWYgaW5fcXVvdGVzIGFuZCBpICsgMSA8IG4gYW5kIHJvd1tpICsgMV0gPT0gIlwiIjoKICAgICAgICAgICAgICAgIGkgKz0gMgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaW5fcXVvdGVzID0gbm90IGluX3F1b3RlcwogICAgICAgIGVsaWYgY2ggPT0gc2VwIGFuZCBub3QgaW5fcXVvdGVzOgogICAgICAgICAgICBjb21tYV9jb3VudCArPSAxCiAgICAgICAgaSArPSAxCiAgICByZXR1cm4gaW5fcXVvdGVzLCBjb21tYV9jb3VudAoKcm93cyA9IFtsaW5lc1swXV0KZm9yIGxpbmUgaW4gbGluZXNbMTpdOgogICAgaWYgbm90IHJvd3M6CiAgICAgICAgcm93cy5hcHBlbmQobGluZSkKICAgICAgICBjb250aW51ZQogICAgaW5fcXVvdGVzX3ByZXYsIF8gPSBhbmFseXplKHJvd3NbLTFdKQogICAgY29tbWFzID0gYW5hbHl6ZShsaW5lKVsxXQogICAgaWYgY29tbWFzIDwgZXhwZWN0ZWRfY29tbWFzOgogICAgICAgIGpvaW5lciA9ICJcbiIgaWYgaW5fcXVvdGVzX3ByZXYgZWxzZSAiICIKICAgICAgICByb3dzWy0xXSA9IHJvd3NbLTFdICsgam9pbmVyICsgbGluZQogICAgZWxpZiBpbl9xdW90ZXNfcHJldjoKICAgICAgICByb3dzWy0xXSA9IHJvd3NbLTFdICsgIlxuIiArIGxpbmUKICAgIGVsc2U6CiAgICAgICAgcm93cy5hcHBlbmQobGluZSkKClBhdGgoZHN0X3BhdGgpLndyaXRlX3RleHQoIlxuIi5qb2luKHJvd3MpICsgIlxuIiwgZW5jb2Rpbmc9InV0Zi04IikK'),'<fix>','exec'))" dirty.csv clean.csv

"import sys,base64;exec(compile(base64.b64decode('ZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmltcG9ydCBzeXMKCnNyY19wYXRoLCBkc3RfcGF0aCA9IHN5cy5hcmd2WzFdLCBzeXMuYXJndlsyXQp0ZXh0ID0gUGF0aChzcmNfcGF0aCkucmVhZF90ZXh0KGVuY29kaW5nPSJ1dGYtOCIsIG5ld2xpbmU9IiIpCmlmIG5vdCB0ZXh0OgogICAgUGF0aChkc3RfcGF0aCkud3JpdGVfdGV4dCgiIiwgZW5jb2Rpbmc9InV0Zi04IikKICAgIHJhaXNlIFN5c3RlbUV4aXQKbGluZXMgPSB0ZXh0LnNwbGl0bGluZXMoKQpzZXAgPSAiLCIKZXhwZWN0ZWRfY29tbWFzID0gbGluZXNbMF0uY291bnQoc2VwKQoKZGVmIGFuYWx5emUocm93KToKICAgIGluX3F1b3RlcyA9IEZhbHNlCiAgICBjb21tYV9jb3VudCA9IDAKICAgIGkgPSAwCiAgICBuID0gbGVuKHJvdykKICAgIHdoaWxlIGkgPCBuOgogICAgICAgIGNoID0gcm93W2ldCiAgICAgICAgaWYgY2ggPT0gIlwiIjoKICAgICAgICAgICAgaWYgaW5fcXVvdGVzIGFuZCBpICsgMSA8IG4gYW5kIHJvd1tpICsgMV0gPT0gIlwiIjoKICAgICAgICAgICAgICAgIGkgKz0gMgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaW5fcXVvdGVzID0gbm90IGluX3F1b3RlcwogICAgICAgIGVsaWYgY2ggPT0gc2VwIGFuZCBub3QgaW5fcXVvdGVzOgogICAgICAgICAgICBjb21tYV9jb3VudCArPSAxCiAgICAgICAgaSArPSAxCiAgICByZXR1cm4gaW5fcXVvdGVzLCBjb21tYV9jb3VudAoKcm93cyA9IFtsaW5lc1swXV0KZm9yIGxpbmUgaW4gbGluZXNbMTpdOgogICAgaWYgbm90IHJvd3M6CiAgICAgICAgcm93cy5hcHBlbmQobGluZSkKICAgICAgICBjb250aW51ZQogICAgaW5fcXVvdGVzX3ByZXYsIF8gPSBhbmFseXplKHJvd3NbLTFdKQogICAgY29tbWFzID0gYW5hbHl6ZShsaW5lKVsxXQogICAgaWYgY29tbWFzIDwgZXhwZWN0ZWRfY29tbWFzOgogICAgICAgIGpvaW5lciA9ICJcbiIgaWYgaW5fcXVvdGVzX3ByZXYgZWxzZSAiICIKICAgICAgICByb3dzWy0xXSA9IHJvd3NbLTFdICsgam9pbmVyICsgbGluZQogICAgZWxpZiBpbl9xdW90ZXNfcHJldjoKICAgICAgICByb3dzWy0xXSA9IHJvd3NbLTFdICsgIlxuIiArIGxpbmUKICAgIGVsc2U6CiAgICAgICAgcm93cy5hcHBlbmQobGluZSkKClBhdGgoZHN0X3BhdGgpLndyaXRlX3RleHQoIlxuIi5qb2luKHJvd3MpICsgIlxuIiwgZW5jb2Rpbmc9InV0Zi04IikK'),'<fix>','exec'))" 



